# 大富翁 AI 设计文档

## 概述

电脑玩家 AI，具备购买、拍卖、建房、收购、交易五大决策模块。

---

## 1. 购买策略 (Purchase)

### 1.1 基本规则
```
如果 玩家现金 >= 地产价格:
    购买
```

### 1.2 拍卖触发条件
```
如果 AI现金 > 地产价格 > 任意其他玩家现金:
    选择拍卖（不购买）
    // 利用对方没钱的优势，可能低价拿下
```

**示例：**
- 地产价格 $200
- AI 有 $500
- 玩家B 只有 $150
- → AI 选择拍卖，因为 B 最多出 $150，AI 可能以 $160 拿下

---

## 2. 拍卖策略 (Auction)

### 2.1 出价逻辑
```
最高出价 = 地产原价 + $10
当前出价 = max(起拍价, 上一轮最高出价 + $10)

如果 当前出价 <= 最高出价 且 当前出价 <= AI现金:
    出价
否则:
    放弃
```

### 2.2 参数
| 参数 | 值 | 说明 |
|------|-----|------|
| 加价幅度 | $10 | 每次出价增加 |
| 最高溢价 | $10 | 最多比原价多付 $10 |

---

## 3. 建房策略 (Building)

### 3.1 中式规则（落地即可建房）
```
优先级：
1. 已成套的颜色组
2. 房屋数最少的地块（均衡发展）

条件：
- 现金 > 房屋价格 + 安全余额($100)
- 持续建房直到无法继续
```

### 3.2 美式规则（需集齐整组）
```
条件更严格：
- 必须拥有整组
- 只有当能给整组每块地都加1栋房时才建
- 保持同组房屋数差距 <= 1

示例：
- 拥有棕色组 (地中海、波罗的海)
- 当前房屋: [2, 2]
- 现金足够建2栋房 → 建成 [3, 3]
- 现金只够建1栋 → 不建（不能变成 [3, 2]）
```

### 3.3 安全余额
```
安全余额 = $100 + 棋盘上最高单次租金 * 0.3
// 留够钱防止踩到高租金破产
```

---

## 4. 收购策略 (Buyout)

### 4.1 条件
```
如果 收购规则开启:
    如果 AI现金 > $1000:
        如果 目标地产能使AI凑成整组:
            收购
        否则如果 目标地产阻止对手成套:
            收购
```

### 4.2 优先级
1. 能让自己成套的地产
2. 能阻止对手成套的关键地产
3. 高价值颜色组（绿色、蓝色）

---

## 5. 交易策略 (Trading)

### 5.1 估值系统

#### 基础价值
```
地产价值 = 购买价格 + 已建房屋价值
房屋价值 = 房屋数 * 建造费用 * 0.5  // 卖出价
```

#### 价值修正
| 情况 | 修正系数 |
|------|----------|
| 能使对方成套 | × 1.5 |
| 会破坏自己的整套 | × ∞ (不卖) |
| 对方已有同色1块 | × 1.2 |
| 对方已有同色2块 | × 1.5 |
| 自己已有同色2块 | × 1.3 (想要) |

### 5.2 交易发起（每3回合）
```
每3回合:
    扫描所有玩家
    寻找"对等交易"机会:
        |AI付出 - 对方付出| <= $10
    
    交易类型：
    1. 地换地（凑套）
    2. 地+钱 换 地
    3. 钱 换 地（买关键地）
```

### 5.3 交易接受
```
如果 对方提出交易:
    计算 AI获得价值 vs AI付出价值
    
    如果 获得 >= 付出 * 0.9:  // 允许小亏
        如果 不会破坏自己整套:
            接受
```

### 5.4 绝对禁止
- 卖掉会导致自己整套变非整套的地产
- 以低于原价 50% 出售地产

---

## 6. 回合决策流程

```
AI回合开始
    │
    ├─ 在监狱？→ 决定是否交钱/用卡出狱
    │
    ├─ 掷骰子 → 移动
    │
    ├─ 落地处理
    │   ├─ 空地 → 购买/拍卖决策
    │   ├─ 他人地产 → 付租金
    │   ├─ 机会/命运 → 执行卡片
    │   └─ 特殊格子 → 处理
    │
    ├─ 建房决策（如果可以）
    │
    ├─ 收购决策（如果规则开启）
    │
    ├─ 交易决策（每3回合）
    │
    └─ 结束回合
```

---

## 7. 难度调节（可选）

| 难度 | 拍卖溢价 | 安全余额 | 交易精明度 |
|------|----------|----------|------------|
| 简单 | +$30 | $50 | 接受亏10%的交易 |
| 普通 | +$10 | $100 | 接受亏5%的交易 |
| 困难 | +$5 | $150 | 只接受赚的交易 |

---

## 8. 待实现文件

```
monopoly/
└── js/
    └── AI.js          # AI 主逻辑
        ├── AIPlayer extends Player
        ├── decidePurchase()
        ├── decideAuction(currentBid)
        ├── decideBuild()
        ├── decideBuyout()
        ├── decideTrade()
        └── evaluateProperty(property)
```

---

## 9. 开放问题

1. **拍卖竞价节奏** - 是否需要"虚张声势"（偶尔跳价）？
2. **交易谈判** - AI 之间要不要自动交易？
3. **监狱策略** - 游戏后期是否应该故意留在监狱？
4. **破产边缘** - 快破产时是否应该激进交易求生？

---

*文档版本: v0.1 - 设计阶段*
